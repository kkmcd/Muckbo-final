<div class="chat_list">
  <p>채팅에서 언제, 어디서 만날건지 정하세요!</p>
  <p>채팅이 만들어 진뒤, 한시간 뒤에 채팅은 없어집니다!</p>
  <% @room.chats.each do |chat| %>
      <p><%= chat.user.email%> : <%= chat.message %><small> <%= chat.created_at %></small></p>
  <%end%>
</div>
<%= form_tag("/rooms/#{@room.id}/chat") do %>
  <%= text_field_tag :message %>
<% end %>

<div class="btn-more">
<%= link_to 'Back', rooms_path(@room) %>
</div>


<script>
  $('#message').val('');
 
 
  function user_chat(data){

      $('.chat_list').append(`<p>${data.email}: ${data.message}</p>`)
  }
 
   var pusher = new Pusher("<%= ENV["Pusher_key"]%>", {
    cluster: "<%= ENV["Pusher_cluster"] %>",
    encrypted: true
  });
 
  var channel = pusher.subscribe("room_<%=@room.id%>");
 
  channel.bind('chat', function(data){
       user_chat(data);
       console.log("채팅중입니다.")
  });
</script>